<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>마크업 가이드</title>
    <link href="./resources/css/index.css" rel="stylesheet" />
    <style>
      #treemenu ul {
        list-style: none;
        padding-left: 15px; /* 들여쓰기 */
      }
      #treemenu .category > span {
        font-weight: bold;
        cursor: default; /* 클릭 기능 없으면 */
        display: block;
        margin-top: 10px;
      }
      #treemenu .sub-items {
        padding-left: 10px; /* 하위 항목 들여쓰기 */
        margin-top: 5px;
      }
      #treemenu a {
        text-decoration: none;
        color: #333;
        display: block;
        padding: 3px 0;
      }
      #treemenu a:hover {
        text-decoration: underline;
        color: #007bff;
      }
      #treemenu a.active {
        /* 현재 활성화된 링크 스타일 */
        font-weight: bold;
        color: #0056b3;
      }
      #treemenu a.status-complete::after {
        /* 완료 상태 표시 예시 */
        content: " ✔";
        color: green;
        font-size: 0.8em;
      }
    </style>
  </head>

  <body>
    <div id="wrap">
      <header id="header">
        <div class="inner">
          <h1 class="title">한화자산운용 마크업 가이드</h1>
          <ul class="nav" id="topNav">
            <li>
              <a href="./markupguide.html">마크업 가이드</a>
            </li>
          </ul>
        </div>
      </header>
      <div id="contents">
        <div class="side_nav" id="sideNav">
          <div id="pages">
            <div id="markupGuide">
              <h2 class="side_title">마크업 가이드</h2>
              <div id="treemenu"></div>
            </div>
          </div>
        </div>
        <div class="contents">
          <iframe
            class="content_frame"
            id="content_frame"
            name="content_frame"
          ></iframe>
          <script>
            const treeContainer = document.getElementById("treemenu");
            const iframe = document.getElementById("content_frame");
            const data = {
              가이드: {
                가이드: ["./guide.html", "complete"],
              },

              엘리먼트: {
                클래스규칙: ["./ele_class.html", "complete"],
                타이포그래피: ["./ele_typo.html", "complete"],
                뱃지: ["./ele_badge.html", "complete"],
              },

              모듈: {
                탭: ["./mod_tabs.html", "complete"],
                아코디언: ["./mod_accordions.html", "complete"],
                목록: ["./mod_lists.html", "complete"],
                인디케이터: ["./mod_indicators.html", "complete"],
                모듈박스: ["./mod_moduleboxs.html", "complete"],
                테이블: ["./mod_tables.html", "complete"],
                정보동의: ["./mod_agrees.html", "complete"],
                프로세스: ["./mod_process.html", "complete"],
                슬라이더: ["./mod_sliders.html", "complete"],
              },

              폼: {
                버튼: ["./form_buttons.html", "complete"],
                "텍스트 필드": ["./form_inputs.html", "complete"],
                셀렉트박스: ["./form_selects.html", "complete"],
                달력: ["./form_calendar.html", "complete"],
                파일첨부: ["./form_files.html", "complete"],
                스위치: ["./form_switch.html", "complete"],
                체크박스: ["./form_checks.html", "complete"],
                라디오버튼: ["./form_radios.html", "complete"],
                폼조합: ["./form_combine.html", "complete"],
              },

              레이아웃: {
                타이틀영역: ["./layout_title.html", "complete"],
                브레드크럼: [
                  "./layout_breadcrumb.html",
                  "complete",
                ],
                영역: ["./layout_dividers.html", "complete"],
                로딩: ["./layout_loadings.html", "complete"],
                로띠: ["./layout_lotties.html", "complete"],
              },
            };

            // 트리 메뉴 생성 함수 (CSS 구조 반영)
            function createTreeMenu(container, treeData, frameName) {
              if (!container || !treeData || !frameName) return;

              // 데이터 객체를 순회하며 카테고리 생성
              for (const category in treeData) {
                const categoryWrap = document.createElement("div");
                categoryWrap.className = "tree_wrap"; // CSS 클래스 적용

                // 카테고리 제목/토글 영역
                const categoryNav = document.createElement("div");
                categoryNav.className = "tree_nav"; // CSS 클래스 적용
                categoryNav.setAttribute("role", "button"); // 접근성 위해 역할 부여
                categoryNav.setAttribute("tabindex", "0"); // 키보드 접근 가능하게
                categoryNav.textContent = category; // 카테고리 이름
                categoryWrap.appendChild(categoryNav);

                // 하위 항목들을 담을 컨테이너
                const subWrap = document.createElement("div");
                subWrap.className = "tree_sub_wrap"; // CSS 클래스 적용
                // subWrap.style.display = 'none'; // 초기에는 숨김 (mui-active 클래스로 제어)

                // 카테고리 내 항목 순회
                for (const subItemName in treeData[category]) {
                  const itemData = treeData[category][subItemName];
                  const url = itemData[0];
                  const status = itemData[1] || "";

                  // 각 항목 리스트 요소
                  const itemDiv = document.createElement("div");
                  itemDiv.className = "tree_lists"; // CSS 클래스 적용
                  if (status) {
                    itemDiv.classList.add(status); // 상태 클래스 추가 (complete, confirm 등)
                  }

                  // 링크를 감싸는 span (CSS 구조 반영)
                  const itemSpan = document.createElement("span");

                  // 실제 링크
                  const link = document.createElement("a");
                  link.href = url;
                  link.textContent = subItemName;
                  link.className = "name"; // CSS 클래스 적용
                  link.target = frameName; // iframe name 속성으로 타겟 지정

                  itemSpan.appendChild(link);
                  itemDiv.appendChild(itemSpan);
                  subWrap.appendChild(itemDiv);
                }

                categoryWrap.appendChild(subWrap);
                container.appendChild(categoryWrap);

                // 카테고리 토글 이벤트 리스너 추가
                categoryNav.addEventListener("click", () => {
                  categoryWrap.classList.toggle("mui-active"); // CSS의 .mui-active 클래스 토글
                });
                // Enter 키로도 토글 가능하게 (접근성)
                categoryNav.addEventListener("keydown", (e) => {
                  if (e.key === "Enter" || e.key === " ") {
                    e.preventDefault(); // 기본 동작(스크롤 등) 방지
                    categoryWrap.classList.toggle("mui-active");
                  }
                });
              }

              // iframe 로드 시 해당 링크 하이라이트
              highlightActiveLink(container, frameName);
            }

            // iframe 로드 시 해당 링크 하이라이트 함수 (CSS 구조 반영)
            function highlightActiveLink(treeRoot, frameName) {
              const frame = window.frames[frameName]; // name으로 iframe 접근
              if (!frame) return;

              const handleLoad = function () {
                try {
                  // iframe 접근 권한 오류 방지
                  const currentFramePath = frame.window.location.pathname;
                  const allLinks =
                    treeRoot.querySelectorAll(".tree_lists a.name"); // 링크 선택자 수정

                  allLinks.forEach((link) => {
                    // link.pathname으로 비교
                    if (link.pathname === currentFramePath) {
                      link.classList.add("mui-highlight"); // CSS 하이라이트 클래스
                    } else {
                      link.classList.remove("mui-highlight");
                    }
                  });
                } catch (e) {
                  console.warn(
                    "Cannot access iframe location, possibly due to cross-origin restrictions.",
                  );
                }
              };

              // 초기 로드 및 이후 src 변경 시 이벤트 리스너
              if (frame.document.readyState === "complete") {
                handleLoad(); // 이미 로드된 경우 즉시 실행
              }
              frame.window.addEventListener("load", handleLoad); // 로드 이벤트 리스너
              // src 변경 감지 (MutationObserver는 src 변경 감지 어려움, load 이벤트 활용)
            }

            // --- 스크립트 실행 ---
            if (treeContainer && iframe && iframe.name) {
              createTreeMenu(treeContainer, data, iframe.name);

              // 초기 iframe 로드 (예: 첫 번째 링크)
              const firstLinkElement =
                treeContainer.querySelector(".tree_lists a.name");
              if (firstLinkElement && firstLinkElement.href) {
                iframe.src = firstLinkElement.href;
                // 첫 로드 후 하이라이트 즉시 적용 시도 (load 이벤트 전에)
                // setTimeout(() => highlightActiveLink(treeContainer, iframe.name), 100); // 약간의 지연 후 실행
              } else {
                console.warn("No links found to set initial iframe source.");
              }
            } else {
              console.error(
                "Tree container or iframe (with name attribute) not found!",
              );
            }
          </script>
        </div>
      </div>
    </div>
  </body>
</html>
