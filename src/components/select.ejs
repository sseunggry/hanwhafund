<%
  const localsSafe = locals || {};
  const title = localsSafe.title || ''; // form-group용 라벨 텍스트
	const ariaLabel = localsSafe.ariaLabel || '';
  const options = Array.isArray(localsSafe.options) ? localsSafe.options : [{ value: 'option1', text: '옵션1'}]; // [{ value: 'v1', text: 'T1', selected: true, disabled: false }, ...]
  const placeholder = localsSafe.placeholder || ''; // 선택적 플레이스홀더
  const size = localsSafe.size || 'medium';
  const disabled = localsSafe.disabled ? 'disabled' : '';
	const variant = localsSafe.variant || ''; //box(기본), text, filter 
  const addClass = localsSafe.addClass || '';
	const slot = localsSafe.slot || '';
  const selectClasses = [
    `form-select`,
		variant,
    size,
    addClass,
    disabled ? 'disabled' : '' // 스타일링을 위한 disabled 클래스 추가
  ].filter(Boolean).join(' ');

	// --- ARIA용 고유 ID 생성 ---
	const uniqueId = `select-${Math.random().toString(36).substring(2, 9)}`;
  const buttonId = `${uniqueId}-button`;
  const listboxId = `${uniqueId}-listbox`;
	const nativeSelectId = `${uniqueId}-native`;

	// --- 선택된 옵션 찾기 ---
	let selectedOption = options.find(opt => opt.selected);
  let initialSelectedValue = selectedOption ? selectedOption.value : null;
  let selectedValueText = placeholder || '';

  if (!selectedValueText && options.length > 0) { // 플레이스홀더가 없고 옵션이 있을 때
    const firstEnabledOption = options.find(opt => !opt.disabled && (opt.value !== '' || opt.text !== '옵션 없음'));
    if (!selectedOption && firstEnabledOption) {
      selectedOption = firstEnabledOption;
      initialSelectedValue = selectedOption.value;
      selectedValueText = selectedOption.text;
    } else if (selectedOption) {
      selectedValueText = selectedOption.text;
    } else if (options.length > 0) { // 선택된 것도, 활성 옵션도 없으면 첫 옵션 텍스트 표시
			selectedValueText = options[0].text !== '옵션 없음' ? options[0].text : '';
    }
  } else if (!selectedValueText && options[0]?.text === '옵션 없음') {
		selectedValueText = '옵션 없음'; // 옵션 배열 자체가 비었을 때
  }
-%>
<%_ if (title) { -%>
<div class="form-group">
  <div class="form-tit">
    <label for="<%= buttonId %>"><%= title %></label>
  </div>
  <div class="form-conts">
<%_ } -%>
		<%_ if (slot) { -%>
    <div class="input-group">
    <%_ } -%>
			<div class="<%= selectClasses %>">
				<select
					class="sr-only"
					name="<%= localsSafe.name || uniqueId %>"
					id="<%= uniqueId %>-native"
					tabindex="-1"
					aria-hidden="true"
					<%- disabled %>
					<%- placeholder ? `data-placeholder="${placeholder}"` : '' %>
					<% if (!title && ariaLabel) { %>
						aria-label="<%= ariaLabel %>"
					<% } %>
				>
					<%_ options.forEach(option => { -%>
						<option 
							value="<%= option.value %>"
							<%= initialSelectedValue === option.value ? 'selected' : '' %>
							<%= option.disabled ? 'disabled' : '' %>
						>
							<%= option.text %>
						</option>
					<%_ }); -%>
				</select>
				<%# --- 커스텀 셀렉트 UI --- %>
				<button
					type="button"
					role="combobox" 
					class="select-button"
					aria-haspopup="listbox" 
					aria-expanded="false" 
					aria-controls="<%= listboxId %>"
					<%- disabled ? 'disabled' : '' %>
					tabindex="0" 
					aria-controls="<%= listboxId %>"
				>
					<span class="select-value <%= (placeholder && !initialSelectedValue) ? 'placeholder' : '' %>"><%= selectedValueText %></span>
				</button>
				<%# 리스트박스는 옵션들을 포함 %>
				<ul
					id="<%= listboxId %>"
					class="select-listbox"
					role="listbox"
					tabindex="-1"
					hidden
					style="--form-select-listbox-option-length: <%= options.length %>"
				>
					<%_ options.forEach(option => { -%>
						<li
							class="select-option <%= option.disabled ? 'disabled' : '' %>"
							role="option"
							data-value="<%= option.value %>"
							aria-selected="<%= option.selected ? 'true' : 'false' %>"
							<%- option.disabled ? 'aria-disabled="true"' : '' %>
							tabindex="-1"
						><%= option.text %></li>
					<%_ }); -%>
				</ul>
			</div>
		<%_ if (slot) { -%>
      <%- slot %>
    </div>
    <%_ } -%>
<% if (title) { -%>
  </div>
</div>
<% } -%>