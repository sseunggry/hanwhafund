<%
  const localsSafe = locals || {};
  const title = localsSafe.title || ''; // form-group용 라벨 텍스트
	const ariaLabel = localsSafe.ariaLabel || '';
  const options = Array.isArray(localsSafe.options) ? localsSafe.options : [{ value: 'option1', text: '옵션1'}]; // [{ value: 'v1', text: 'T1', selected: true, disabled: false }, ...]
  const placeholder = localsSafe.placeholder || ''; // 선택적 플레이스홀더
  const size = localsSafe.size || 'medium';
  const disabled = localsSafe.disabled ? 'disabled' : '';
	const variant = localsSafe.variant || ''; //box(기본), text, filter 
  const addClass = localsSafe.addClass || '';
	const slot = localsSafe.slot || '';
  const selectClasses = [
    `form-select`,
		variant,
    size,
    addClass,
    disabled ? 'disabled' : '' // 스타일링을 위한 disabled 클래스 추가
  ].filter(Boolean).join(' ');

	const targetGroup = localsSafe.targetGroup || '';

	// --- ARIA용 고유 ID 생성 ---
	const uniqueId = `select-${Math.random().toString(36).substring(2, 9)}`;
  const buttonId = `${uniqueId}-button`;
  const listboxId = `${uniqueId}-listbox`;
	const nativeSelectId = `${uniqueId}-native`;

	// --- 선택된 옵션 찾기 ---
	let initialSelectedValue = null;
  let selectedValueText = placeholder || '';

  const explicitSelected = options.find(opt => opt.selected === true);

  if (explicitSelected) {
    initialSelectedValue = explicitSelected.value;
    selectedValueText = explicitSelected.text;
  } else if (!placeholder && options.length > 0) {
    const firstEnabled = options.find(opt => !opt.disabled);
    if (firstEnabled) {
      initialSelectedValue = firstEnabled.value;
      selectedValueText = firstEnabled.text;
    } else {
        selectedValueText = options[0].text;
    }
  }

	const isLinkMode = options.some(opt => opt.url);
	const listRoleAttr = isLinkMode ? '' : 'role="listbox"';
  const itemRoleAttr = isLinkMode ? '' : 'role="option"';
	const optionsLength = localsSafe.optionsLength || options.length;
-%>
<%_ if (title) { -%>
<div class="form-group">
  <div class="form-tit">
    <label for="<%= buttonId %>"><%= title %></label>
  </div>
  <div class="form-conts">
<%_ } -%>
		<%_ if (slot) { -%>
    <div class="input-group">
    <%_ } -%>
			<div class="<%= selectClasses %>" <%- targetGroup ? `data-target-group="${targetGroup}"` : '' %>>
				<select
					class="sr-only"
					name="<%= localsSafe.name || uniqueId %>"
					id="<%= uniqueId %>"
					tabindex="-1"
					aria-hidden="true"
					<%- disabled %>
					<%- placeholder ? `data-placeholder="${placeholder}"` : '' %>
					<% if (!title && ariaLabel) { -%>
						aria-label="<%= ariaLabel %>"
					<% } -%>
				>
					<%_ options.forEach(option => { -%>
						<option 
							value="<%= option.value %>"
							<%= (initialSelectedValue === option.value) ? 'selected' : '' %>
							<%= option.disabled ? 'disabled' : '' %>
						>
							<%= option.text %>
						</option>
					<%_ }) -%>
				</select>
				<button
					type="button"
					role="combobox" 
					class="select-button"
					aria-haspopup="listbox" 
					aria-expanded="false" 
					aria-controls="<%= listboxId %>"
					<%- disabled ? 'disabled' : '' %>
					tabindex="0"
				>
					<span class="select-value <%= (placeholder && !initialSelectedValue) ? 'placeholder' : '' %>"><%= selectedValueText %></span>
				</button>
				<ul
					id="<%= listboxId %>"
					class="select-listbox"
					<%= isLinkMode ? '' : 'role="listbox"' %>
					tabindex="-1"
					hidden
					style="--form-select-listbox-option-length: <%= optionsLength %>"
				>
					<%_ options.forEach(option => { -%>
						<li
							class="select-option <%= option.disabled ? 'disabled' : '' %>"
							<%= option.url ? '' : 'role="option"' %>
							data-value="<%= option.value %>"
							aria-selected="<%= (initialSelectedValue === option.value) ? 'true' : 'false' %>"
							<%- option.disabled ? 'aria-disabled="true"' : '' %>
							tabindex="-1"
						>
						<% if (option.url) { %>
							<a href="<%= option.url %>" 
								target="<%= option.target || '_self' %>" 
								class="item-link"
								<%= (option.target === '_blank') ? 'title="새창열림"' : '' %>
						 	>
						<% } %>
							<%= option.text %>
						<% if (option.url) { %>
							</a>
						<% } %>
						</li>
					<%_ }) -%>
				</ul>
			</div>
		<%_ if (slot) { -%>
      <%- slot %>
    </div>
    <%_ } -%>
<% if (title) { -%>
  </div>
</div>
<% } -%>