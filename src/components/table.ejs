<%
  const localsSafe = locals || {};
  const caption = localsSafe.captionTitle || ''; 
  const thead = Array.isArray(localsSafe.thead) ? localsSafe.thead : [];
  const tbody = Array.isArray(localsSafe.tbody) ? localsSafe.tbody : [];
  const addClass = localsSafe.addClass || '';
  const colWidths = Array.isArray(localsSafe.colWidths) ? localsSafe.colWidths : [];
  const rowHeaders = localsSafe.rowHeaders === true;
  const colCount = thead.length; // 컬럼 수
  const captionSummary = thead.join(', ');
	const colAligns = Array.isArray(localsSafe.colAligns) ? localsSafe.colAligns : [];

  const wrapClasses = [
    'tbl-wrap', // 기본 래퍼 클래스
    addClass
  ].filter(Boolean).join(' ');
-%>
<% if (colCount > 0 || tbody.length > 0) { -%>
<div class="<%= wrapClasses %>">
  <table class="tbl">
    <caption>
      <% if (caption) { -%><strong><%- caption %></strong><% } -%>
      <span><%- captionSummary %>로 구성된 표</span>
    </caption>
    <% if (colCount > 0) { -%>
    <colgroup>
      <% for (let i = 0; i < colCount; i++) { -%>
        <% if (colWidths[i]) { -%>
          <col style="width: <%= colWidths[i] %>;" />
        <% } else { -%>
          <col />
        <% } -%>
      <% } -%>
    </colgroup>
    <% } -%>
    <% if (colCount > 0) { -%>
    <thead>
      <tr>
        <% thead.forEach((header) => { -%>
        <th scope="col"><%- header %></th>
        <% }); -%>
      </tr>
    </thead>
    <% } -%>
    <% if (tbody.length > 0) { -%>
    <tbody>
      <% tbody.forEach(row => { -%>
      <tr>
			<% row.forEach((cellData, index) => { -%>
      <% 
        if (cellData === null) return;

        let cellText = '';
        let cellAttrs = '';
        let cellClass = colAligns[index] ? `txt-${colAligns[index]}` : '';

        if (typeof cellData === 'object' && cellData !== null) {
          cellText = cellData.text || '';
          if (cellData.rowspan) cellAttrs += ` rowspan="${cellData.rowspan}"`;
          if (cellData.colspan) cellAttrs += ` colspan="${cellData.colspan}"`;
          if (cellData.class) cellClass = cellData.class; // 클래스 직접 지정
          else if (cellData.align) cellClass = `txt-${cellData.align}`; // 정렬 지정
        } else {
          cellText = cellData;
        }
        
        const classAttr = cellClass ? `class="${cellClass}"` : '';
        const finalAttrs = (cellAttrs + ' ' + classAttr).trim();
      -%>
			<% if (cellData !== null) { -%>
      <% if (index === 0 && rowHeaders) { -%>
        <th scope="row" <%- finalAttrs %>><%- cellText %></th>
      <% } else { -%>
        <td <%- finalAttrs %>><%- cellText %></td>
      <% } -%>
      <% } -%>
      <% }) -%>
      </tr>
      <% }) -%>
    </tbody>
    <% } -%>
  </table>
</div>
<% } -%>