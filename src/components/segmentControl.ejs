<%
  const localsSafe = locals || {};
  const size = localsSafe.size || '';  //large 기본값
  const title = localsSafe.title || '세그먼트 컨트롤';
  const tag = localsSafe.tag || 'radio'; // tag: 'radio' (기본값) 또는 'button'
	const variant = localsSafe.variant || ''; // 기본, bg
  const items = Array.isArray(localsSafe.items) ? localsSafe.items : [{ label: 'control1', value: 'control1' }];
  const full = localsSafe.full ? 'full' : '';
  const name = localsSafe.name || `segment-${Math.random().toString(36).substring(2, 9)}`;
  const addClass = localsSafe.addClass || '';
  const classes = [
    `segment-control`,
    size,
    full,
		variant,
    addClass,
  ].filter(Boolean).join(' ');

  let initialCheckedIndex = items.findIndex(item => item.checked && !item.disabled);
  if (initialCheckedIndex === -1) { 
    initialCheckedIndex = items.findIndex(item => !item.disabled); 
    if (initialCheckedIndex === -1) initialCheckedIndex = 0;
  }
-%>
<%# tag가 'button'일 때만 role="radiogroup" 적용 %>
<div class="<%= classes %>" <%- tag === 'button' ? `role="radiogroup"` : '' %> aria-label="<%= title %>">
<%_ items.forEach((item, index) => { -%>
<%_
  const itemLabel = item.label || `옵션 ${index + 1}`;
  const itemValue = item.value || itemLabel;
  const itemDisabled = item.disabled ? 'disabled' : '';
  const isChecked = index === initialCheckedIndex;
  const uniqueId = `segment-${index}-${Math.random().toString(36).substring(2, 9)}`;
  const controlClasses = ['control-btn', itemDisabled].filter(Boolean).join(' ');
-%>
<%_ if (tag === 'radio') { -%>
  <%# 네이티브 라디오 + 라벨 방식 %>
  <label for="<%= uniqueId %>" class="<%= controlClasses %>">
    <input
      type="radio"
      class="sr-only"
      id="<%= uniqueId %>"
      name="<%= name %>"
      value="<%= itemValue %>"
      <%= isChecked ? 'checked' : '' %>
      <%= itemDisabled %>
    />
    <span><%= itemLabel %></span>
  </label>
<%_ } else { -%>
  <%# ARIA 버튼 방식 %>
  <button
    type="button"
    class="<%= controlClasses %> <%= isChecked ? 'active' : '' %>" <%# 초기 active 클래스 %>
    role="radio"
    aria-checked="<%= isChecked ? 'true' : 'false' %>"
    tabindex="<%= isChecked ? '0' : '-1' %>"
    <%= itemDisabled %>
  >
    <%= itemLabel -%>
  </button>
<%_ } -%>
<%_ }); -%>
</div>