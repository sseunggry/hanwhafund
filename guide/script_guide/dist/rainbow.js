!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Rainbow=t()}(this,function(){"use strict";function a(){return"undefined"!=typeof module&&"object"==typeof module.exports}function h(e,t,n,a){return(n!==e||a!==t)&&(n<=e&&t<=a)}function r(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&(?![\w\#]+;)/g,"&amp;")}function b(e,t){for(var n=0,a=1;a<t;++a)e[a]&&(n+=e[a].length);return n}function w(e,t,n,a){return e<=n&&n<t||e<a&&a<t}function y(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n.sort(function(e,t){return t-e})}function L(e,t,n,a){var r=a.substr(e);return n=n.replace(/\$/g,"$$$$"),a.substr(0,e)+r.replace(t,n)}var N=function N(f){var g,m={},p={};function v(e,t){var e=e.replace(/\./g," "),n=f.globalClass;return n&&(e+=" "+n),'<span class="'+e+'">'+t+"</span>"}function d(s,e,t){void 0===t&&(t=0);var n=s.pattern;if(!n)return!1;var a=!n.global,c=(o="",(r=n).ignoreCase&&(o+="i"),r.multiline&&(o+="m"),(n=new RegExp(r.source,o)).exec(e));if(!c)return!1;!s.name&&s.matches&&"string"==typeof s.matches[0]&&(s.name=s.matches[0],delete s.matches[0]);var l=c[0],r=c.index+t,o=c[0].length+r;if(r===o)return!1;if(function(e,t){for(var n in p)if(h(n=parseInt(n,10),p[n],e,t)&&(delete p[n],delete m[n]),w(n,p[n],e,t))return 1}(r,o))return{remaining:e.substr(o-t),offset:o};function i(a){var e,t,n,r,o,i=c[a];i&&(t=(e=s.matches[a]).language,n=e.name&&e.matches?e.matches:e,r=function(e,t,n){l=L(b(c,a),e,n?v(n,t):t,l)},"string"==typeof e?r(i,i,e):(o=new N(f),t?r(i,o.refract(i,t)):r(i,o.refract(i,g,n.length?n:[n]),e.matches?e.name:0)))}for(var u=0,d=y(s.matches);u<d.length;u+=1)i(d[u]);return n=l,s.name&&(n=v(s.name,n)),m[r]={replace:c[0],"with":n},p[r]=o,!a&&{remaining:e.substr(o-t),offset:o}}function a(e,t){for(var n=0,a=t;n<a.length;n+=1)for(var r=a[n],o=d(r,e);o;)o=d(r,o.remaining,o.offset);for(var i=e,s=0,c=y(m);s<c.length;s+=1){var l=c[s],u=m[l];i=L(l,u.replace,u["with"],i)}return i}this.refract=function(e,t,n){return g=t,n=n||function(e){for(var t=f.patterns[e]||[];f.inheritenceMap[e];)e=f.inheritenceMap[e],t=t.concat(f.patterns[e]||[]);return t}(t),a(r(e),n)}};function o(e){var t=e.data,n=new N(t.options).refract(t.code,t.lang);function a(){self.postMessage({id:t.id,lang:t.lang,result:n})}t.isNode?a():setTimeout(function(){a()},1e3*t.options.delay)}var l,i={},s={},c={},t={},u=0,d=a(),e="undefined"==typeof document&&"undefined"!=typeof self,f=null;function g(){var e,t,n;return!d&&null!==f||(e=o,t=N,f=a()?(global.Worker=require("web-worker"),new Worker(__filename)):(t=t.toString(),n=y.toString(),t=(n=(n=(n=(n=(n+=r.toString())+h.toString())+w.toString())+L.toString())+b.toString()+t)+"\tthis.onmessage="+e.toString(),n=new Blob([t],{type:"text/javascript"}),new Worker((window.URL||window.webkitURL).createObjectURL(n)))),f}function m(t,n){var a=g();a.addEventListener("message",function r(e){e.data.id===t.id&&(n(e.data),a.removeEventListener("message",r),d&&a.terminate())}),a.postMessage(t)}function p(e,t){var n={};return"object"==typeof t&&(t=(n=t).language),t=c[t]||t,{id:u++,code:e,lang:t,options:{patterns:i,inheritenceMap:s,aliases:c,globalClass:(e=n).globalClass,delay:isNaN(e.delay)?0:e.delay},isNode:d}}function v(e,t){for(var n={c:0},a=0,r=e;a<r.length;a+=1){var o,i,s=r[a],c=(i=o=void 0,(i=(c=s).getAttribute("data-language")||c.parentNode.getAttribute("data-language"))||(o=c.className.match(o=/\blang(?:uage)?-(\w+)/)||c.parentNode.className.match(o))&&(i=o[1]),i?i.toLowerCase():null);!s.classList.contains("rainbow")&&c&&(s.classList.add("loading"),s.classList.add("rainbow"),"PRE"===s.parentNode.tagName&&s.parentNode.classList.add("loading"),o=s.getAttribute("data-global-class"),i=parseInt(s.getAttribute("data-delay"),10),++n.c,m(p(s.innerHTML,{language:c,globalClass:o,delay:i}),function(t,n,a){return function(e){t.innerHTML=e.result,t.classList.remove("loading"),t.classList.add("rainbow-show"),"PRE"===t.parentNode.tagName&&(t.parentNode.classList.remove("loading"),t.parentNode.classList.add("rainbow-show")),l&&l(t,e.lang),0==--n.c&&a()}}(s,n,t)))}0===n.c&&t()}function E(e,t){t=t||function(){};for(var n=(e=e&&"function"==typeof e.getElementsByTagName?e:document).getElementsByTagName("pre"),e=e.getElementsByTagName("code"),a=[],r=[],o=0,i=n;o<i.length;o+=1){var s=i[o],c=(u=l=c=void 0,s),l=document.createElement("div");l.className="preloader";for(var u=0;u<7;u++)l.appendChild(document.createElement("div"));c.appendChild(l),s.getElementsByTagName("code").length?s.getAttribute("data-trimmed")||(s.setAttribute("data-trimmed",!0),s.innerHTML=s.innerHTML.trim()):a.push(s)}for(var d=0,f=e;d<f.length;d+=1){var g=f[d];r.push(g)}v(r.concat(a),t)}return t={extend:function(e,t,n){s[e]||(s[e]=n),i[e]=t.concat(i[e]||[])},remove:function(e){delete s[e],delete i[e]},onHighlight:function(e){l=e},addAlias:function(e,t){c[e]=t},color:function(){for(var t,e=[],n=arguments.length;n--;)e[n]=arguments[n];"string"==typeof e[0]?m(p(e[0],e[1]),(t=e[2],function(e){t&&t(e.result,e.lang)})):"function"==typeof e[0]?E(0,e[0]):E(e[0],e[1])}},d&&(t.colorSync=function(e,t){e=p(e,t);return new N(e.options).refract(e.code,e.lang)}),d||e||document.addEventListener("DOMContentLoaded",function(e){t.defer||t.color(e)},!1),e&&(self.onmessage=o),t});